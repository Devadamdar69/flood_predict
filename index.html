<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Flood Prediction ‚Äî Landing</title>
<style>
  :root{
    --sky-top:#87ceeb;
    --sky-bottom:#5aa0d6;
    --glow: rgba(0,150,255,0.85);
  }
  html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,Arial; -webkit-font-smoothing:antialiased;}
  body{background:linear-gradient(var(--sky-top),var(--sky-bottom));overflow-x:hidden;color:#fff;}

  .hero{position:relative;height:100vh;width:100%;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .sky{position:absolute;inset:0;z-index:0;background:linear-gradient(rgba(255,255,255,0.02),rgba(0,0,0,0.05))}

  /* static background video container */
  .video-container{position:absolute;inset:0;z-index:1;overflow:hidden;pointer-events:none}
  .video-reveal{position:absolute;inset:0;z-index:1;
    /* reveal is visual; clip-path left->right is available if needed */
    clip-path: inset(0 0 0 0); -webkit-clip-path: inset(0 100% 0 0);
    animation: revealVideo 3.8s cubic-bezier(.22,.9,.33,1) forwards;
    will-change: clip-path;
  }
  @keyframes revealVideo { from{ clip-path: inset(0 0 0 0); } to{ clip-path: inset(0 0 0 0); } }

  .video-reveal video{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; display:block; filter:saturate(1.05) contrast(1.03) }

  /* overlay to improve contrast */
  .video-overlay{position:absolute; inset:0; z-index:2; background: linear-gradient(180deg, rgba(0,0,0,0.06), rgba(0,0,0,0.28)); pointer-events:none}

  /* title box with glow */
  .center-text{position:relative; z-index:4; text-align:center; pointer-events:none; padding:0 20px; width:100%;}
  .title-box{display:inline-block; position:relative; background:rgba(0,0,0,0.66); padding: clamp(12px,2vw,18px) clamp(18px,3vw,36px); border-radius:12px; backdrop-filter:blur(4px); box-shadow:0 8px 28px rgba(0,0,0,0.55); opacity:0; transform:translateY(8px); transition:opacity .45s ease, transform .45s ease}
  .title-box::before{content:""; position:absolute; inset:-10px; z-index:-1; background:radial-gradient(circle at 50% 40%, var(--glow), rgba(0,0,0,0)); filter:blur(18px); opacity:0.9; border-radius:14px; pointer-events:none}
  .title-box.visible{opacity:1; transform:translateY(0)}

  .title{font-size:clamp(1.6rem,4.5vw,2.8rem); margin:0; color:#fff; font-weight:700; letter-spacing:0.6px; text-shadow:0 8px 22px rgba(0,0,0,0.6)}
  .cursor{display:inline-block;margin-left:8px;color:rgba(255,255,255,0.95); font-weight:700; animation: blink 1s steps(2,start) infinite}
  @keyframes blink{50%{opacity:0}}
  .subtitle{margin-top:10px; font-size:clamp(.9rem,2.2vw,1.05rem); color:rgba(255,255,255,0.92)}

  /* scroll hint */
  .scroll-hint{position:absolute;bottom:18px;left:50%;transform:translateX(-50%);z-index:6; font-size:0.95rem; color:rgba(255,255,255,0.9); opacity:0.95}

  /* fade overlay applied before navigation */
  .fade-out { position:fixed; inset:0; background:#000; z-index:9999; pointer-events:none; opacity:0; transition:opacity .55s ease; }
  .fade-out.visible { opacity:1; }

  /* map section placeholder (if user scrolls there) */
  .map-section{min-height:100vh;padding:60px 20px;display:flex;align-items:center;justify-content:center;background:#f6f8fb;color:#1b2b3a;font-weight:600;font-size:clamp(1.2rem,2.4vw,1.6rem)}
  @media(max-width:560px){ .title{font-size:1.6rem} .title-box::before{inset:-8px;filter:blur(14px)}}
</style>
</head>
<body>

<section class="hero" aria-label="Intro ‚Äî Flood Prediction">
  <div class="sky" aria-hidden="true"></div>

  <!-- Video + reveal mask -->
  <div class="video-container" aria-hidden="true">
    <div id="videoReveal" class="video-reveal">
      <video id="bgVideo" src="1879456-hd_1280_720_30fps.mp4" autoplay muted loop playsinline preload="auto"></video>
    </div>
  </div>

  <div class="video-overlay" aria-hidden="true"></div>

  <!-- center title -->
  <div class="center-text" role="presentation">
    <div id="titleBox" class="title-box" aria-live="polite" aria-atomic="true">
      <h1 class="title"><span id="typed"></span><span class="cursor" aria-hidden="true">|</span></h1>
      <div class="subtitle">Accurate flood forecasts for better preparedness</div>
    </div>
  </div>

  <div class="scroll-hint">Scroll down to continue</div>
</section>

<!-- placeholder second section so scrolling behavior is normal on long pages -->
<section class="map-section">
  üó∫Ô∏è This will take you to the globe ‚Äî scroll down further to automatically open the globe page.
</section>

<!-- fade overlay used before redirect -->
<div id="fade" class="fade-out" aria-hidden="true"></div>

<script>
  // CONFIG: change this to control delay after the VIDEO STARTS PLAYING (ms)
  // Example: 2000 = 2 seconds, 4000 = 4 seconds
  const TEXT_DELAY_MS = 2000;

  // --- Typewriter texts ---
  const texts = ["Flood Prediction", "‡§¨‡§æ‡§¢‡§º ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®"];
  const typedEl = document.getElementById('typed');
  const titleBox = document.getElementById('titleBox');

  // Typewriter settings (you can tweak these too)
  const TYPING_SPEED = 90;
  const DELETING_SPEED = 55;
  const PAUSE_AFTER_TYPING = 1000;

  // Video + reveal references
  const videoReveal = document.getElementById('videoReveal');
  const bgVideo = document.getElementById('bgVideo');
  const fade = document.getElementById('fade');

  // internal state
  let revealTimer = null;
  let started = false; // ensures we only start once

  // Ensure video playback: try play(), if blocked, wait for first user gesture
  function tryPlayVideo(){
    if (!bgVideo) return;
    const p = bgVideo.play();
    if (p !== undefined){
      p.catch(() => {
        // autoplay blocked: wait for user interaction and then play
        const resume = () => { bgVideo.play().catch(()=>{}); window.removeEventListener('pointerdown', resume); window.removeEventListener('touchstart', resume); };
        window.addEventListener('pointerdown', resume);
        window.addEventListener('touchstart', resume);
      });
    }
  }
  tryPlayVideo();

  // schedule reveal after TEXT_DELAY_MS from video playing
  function scheduleRevealAfterVideo(){
    if (started) return;
    clearTimeout(revealTimer);
    revealTimer = setTimeout(() => { onRevealEnd(); }, TEXT_DELAY_MS);
  }

  // Listen for the video actually playing (this ensures delay begins once the video is visible & playing)
  // 'playing' fires after autoplay or after user resumes playback
  if (bgVideo) {
    bgVideo.addEventListener('playing', () => {
      // schedule reveal relative to actual playback start
      scheduleRevealAfterVideo();
    }, { once: true });

    // sometimes autoplay already succeeded before listener attached; check readyState/paused
    if (!bgVideo.paused && bgVideo.readyState > 2) {
      scheduleRevealAfterVideo();
    }
  }

  // For safety: also start reveal if the CSS reveal animation ends (keeps previous behavior)
  videoReveal.addEventListener('animationend', () => {
    // only call if not already started; animationend might happen earlier than video play
    // if you prefer animationend to *override* video timing, remove this guard
    if (!started) {
      // if video already playing, still respect TEXT_DELAY_MS from playing; otherwise show immediately
      if (bgVideo && !bgVideo.paused) {
        scheduleRevealAfterVideo();
      } else {
        // if video hasn't started, just trigger after TEXT_DELAY_MS from now
        scheduleRevealAfterVideo();
      }
    }
  });

  // fallback: if neither 'playing' nor animationend triggers, ensure text appears after a max timeout
  const MAX_FALLBACK = Math.max(2000, TEXT_DELAY_MS + 1500);
  setTimeout(() => { if (!started) scheduleRevealAfterVideo(); }, MAX_FALLBACK);

  // Main reveal handler (idempotent)
  function onRevealEnd(){
    if (started) return;
    started = true;
    clearTimeout(revealTimer);
    titleBox.classList.add('visible');
    startTypewriterLoop();
  }

  // Typewriter loop
  function startTypewriterLoop(){
    let idx=0, cidx=0, deleting=false;
    function tick(){
      const cur = texts[idx];
      if (!deleting){
        cidx++;
        typedEl.textContent = cur.slice(0,cidx);
        if (cidx === cur.length){ setTimeout(()=>{deleting=true; tick();}, PAUSE_AFTER_TYPING); return; }
        setTimeout(tick, TYPING_SPEED);
      } else {
        cidx--;
        typedEl.textContent = cur.slice(0,cidx);
        if (cidx === 0){ deleting=false; idx=(idx+1)%texts.length; setTimeout(tick, 220); return; }
        setTimeout(tick, DELETING_SPEED);
      }
    }
    tick();
  }

  // NAVIGATION ON SCROLL (no click)
  let navigated = false;
  const SCROLL_THRESHOLD = 40; // pixels of deltaY to trigger navigation
  function navigateToGlobe(){
    if (navigated) return;
    navigated = true;
    fade.classList.add('visible');
    setTimeout(()=>{ window.location.href = 'globe.html'; }, 520);
  }

  // wheel listener (desktop)
  window.addEventListener('wheel', (e) => {
    if (navigated) return;
    if (e.deltaY > SCROLL_THRESHOLD) navigateToGlobe();
  }, {passive:true});

  // touch swipe (mobile)
  let touchStartY = null;
  window.addEventListener('touchstart', (e)=>{ if(e.touches && e.touches[0]) touchStartY = e.touches[0].clientY; }, {passive:true});
  window.addEventListener('touchend', (e)=>{
    if (navigated) return;
    if (!touchStartY) return;
    const endY = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0].clientY : null;
    if (endY === null) { touchStartY = null; return; }
    const diff = touchStartY - endY;
    if (diff > 60) navigateToGlobe(); // swipe up
    touchStartY = null;
  }, {passive:true});

  // keyboard support (PageDown / ArrowDown / Space)
  window.addEventListener('keydown', (e)=>{
    if (navigated) return;
    if (e.key === 'ArrowDown' || e.key === 'PageDown' || e.key === ' ') navigateToGlobe();
  });

  // Attempt to recover if video fails to load ‚Äî show poster background and still reveal text
  bgVideo.addEventListener('error', (ev) => {
    console.warn('Video failed to load; falling back to static background.', ev);
    document.querySelector('.video-container').style.background = 'linear-gradient(#0c4a70,#083a58)';
    // still ensure text appears after the configured delay (counting from now)
    scheduleRevealAfterVideo();
  });

  // Also ensure video plays when user interacts (some browsers require gesture)
  window.addEventListener('pointerdown', tryPlayVideo, {passive:true});
  window.addEventListener('touchstart', tryPlayVideo, {passive:true});
</script>
</body>
</html>
